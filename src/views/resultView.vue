<template>
<div class="">
    <div class="container">
<div class="logo" :class="{scroll: scroll}">
<svg width="200" height="200" viewBox="0 0 832 804" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M827 402C827 621.097 643.152 799 416 799C188.848 799 5 621.097 5 402C5 182.903 188.848 5 416 5C643.152 5 827 182.903 827 402Z" stroke="url(#paint0_linear)" stroke-width="10"/>
<path d="M230.42 371.96V422H222.212V387.728L206.948 422H201.26L185.924 387.728V422H177.716V371.96H186.572L204.14 411.2L221.636 371.96H230.42ZM249.417 368.72V422H241.209V368.72H249.417ZM257.457 401.984C257.457 398 258.273 394.472 259.905 391.4C261.585 388.328 263.841 385.952 266.673 384.272C269.553 382.544 272.721 381.68 276.177 381.68C279.297 381.68 282.009 382.304 284.313 383.552C286.665 384.752 288.537 386.264 289.929 388.088V382.328H298.209V422H289.929V416.096C288.537 417.968 286.641 419.528 284.241 420.776C281.841 422.024 279.105 422.648 276.033 422.648C272.625 422.648 269.505 421.784 266.673 420.056C263.841 418.28 261.585 415.832 259.905 412.712C258.273 409.544 257.457 405.968 257.457 401.984ZM289.929 402.128C289.929 399.392 289.353 397.016 288.201 395C287.097 392.984 285.633 391.448 283.809 390.392C281.985 389.336 280.017 388.808 277.905 388.808C275.793 388.808 273.825 389.336 272.001 390.392C270.177 391.4 268.689 392.912 267.537 394.928C266.433 396.896 265.881 399.248 265.881 401.984C265.881 404.72 266.433 407.12 267.537 409.184C268.689 411.248 270.177 412.832 272.001 413.936C273.873 414.992 275.841 415.52 277.905 415.52C280.017 415.52 281.985 414.992 283.809 413.936C285.633 412.88 287.097 411.344 288.201 409.328C289.353 407.264 289.929 404.864 289.929 402.128ZM317.198 388.232C318.59 386.312 320.486 384.752 322.886 383.552C325.334 382.304 328.046 381.68 331.022 381.68C334.526 381.68 337.694 382.52 340.526 384.2C343.358 385.88 345.59 388.28 347.222 391.4C348.854 394.472 349.67 398 349.67 401.984C349.67 405.968 348.854 409.544 347.222 412.712C345.59 415.832 343.334 418.28 340.454 420.056C337.622 421.784 334.478 422.648 331.022 422.648C327.95 422.648 325.214 422.048 322.814 420.848C320.462 419.648 318.59 418.112 317.198 416.24V422H308.99V368.72H317.198V388.232ZM341.318 401.984C341.318 399.248 340.742 396.896 339.59 394.928C338.486 392.912 336.998 391.4 335.126 390.392C333.302 389.336 331.334 388.808 329.222 388.808C327.158 388.808 325.19 389.336 323.318 390.392C321.494 391.448 320.006 392.984 318.854 395C317.75 397.016 317.198 399.392 317.198 402.128C317.198 404.864 317.75 407.264 318.854 409.328C320.006 411.344 321.494 412.88 323.318 413.936C325.19 414.992 327.158 415.52 329.222 415.52C331.334 415.52 333.302 414.992 335.126 413.936C336.998 412.832 338.486 411.248 339.59 409.184C340.742 407.12 341.318 404.72 341.318 401.984ZM379.802 422.504C378.314 422.504 377.066 422 376.058 420.992C375.05 419.984 374.546 418.736 374.546 417.248C374.546 415.76 375.05 414.512 376.058 413.504C377.066 412.496 378.314 411.992 379.802 411.992C381.242 411.992 382.466 412.496 383.474 413.504C384.482 414.512 384.986 415.76 384.986 417.248C384.986 418.736 384.482 419.984 383.474 420.992C382.466 422 381.242 422.504 379.802 422.504ZM420.768 388.088C421.968 386.072 423.552 384.512 425.52 383.408C427.536 382.256 429.912 381.68 432.648 381.68V390.176H430.56C427.344 390.176 424.896 390.992 423.216 392.624C421.584 394.256 420.768 397.088 420.768 401.12V422H412.56V382.328H420.768V388.088ZM476.553 401.192C476.553 402.68 476.457 404.024 476.265 405.224H445.953C446.193 408.392 447.369 410.936 449.481 412.856C451.593 414.776 454.185 415.736 457.257 415.736C461.673 415.736 464.793 413.888 466.617 410.192H475.473C474.273 413.84 472.089 416.84 468.921 419.192C465.801 421.496 461.913 422.648 457.257 422.648C453.465 422.648 450.057 421.808 447.033 420.128C444.057 418.4 441.705 416 439.977 412.928C438.297 409.808 437.457 406.208 437.457 402.128C437.457 398.048 438.273 394.472 439.905 391.4C441.585 388.28 443.913 385.88 446.889 384.2C449.913 382.52 453.369 381.68 457.257 381.68C461.001 381.68 464.337 382.496 467.265 384.128C470.193 385.76 472.473 388.064 474.105 391.04C475.737 393.968 476.553 397.352 476.553 401.192ZM467.985 398.6C467.937 395.576 466.857 393.152 464.745 391.328C462.633 389.504 460.017 388.592 456.897 388.592C454.065 388.592 451.641 389.504 449.625 391.328C447.609 393.104 446.409 395.528 446.025 398.6H467.985ZM499.03 422.648C495.91 422.648 493.102 422.096 490.606 420.992C488.158 419.84 486.214 418.304 484.774 416.384C483.334 414.416 482.566 412.232 482.47 409.832H490.966C491.11 411.512 491.902 412.928 493.342 414.08C494.83 415.184 496.678 415.736 498.886 415.736C501.19 415.736 502.966 415.304 504.214 414.44C505.51 413.528 506.158 412.376 506.158 410.984C506.158 409.496 505.438 408.392 503.998 407.672C502.606 406.952 500.374 406.16 497.302 405.296C494.326 404.48 491.902 403.688 490.03 402.92C488.158 402.152 486.526 400.976 485.134 399.392C483.79 397.808 483.118 395.72 483.118 393.128C483.118 391.016 483.742 389.096 484.99 387.368C486.238 385.592 488.014 384.2 490.318 383.192C492.67 382.184 495.358 381.68 498.382 381.68C502.894 381.68 506.518 382.832 509.254 385.136C512.038 387.392 513.526 390.488 513.718 394.424H505.51C505.366 392.648 504.646 391.232 503.35 390.176C502.054 389.12 500.302 388.592 498.094 388.592C495.934 388.592 494.278 389 493.126 389.816C491.974 390.632 491.398 391.712 491.398 393.056C491.398 394.112 491.782 395 492.55 395.72C493.318 396.44 494.254 397.016 495.358 397.448C496.462 397.832 498.094 398.336 500.254 398.96C503.134 399.728 505.486 400.52 507.31 401.336C509.182 402.104 510.79 403.256 512.134 404.792C513.478 406.328 514.174 408.368 514.222 410.912C514.222 413.168 513.598 415.184 512.35 416.96C511.102 418.736 509.326 420.128 507.022 421.136C504.766 422.144 502.102 422.648 499.03 422.648ZM559.019 382.328V422H550.811V417.32C549.515 418.952 547.811 420.248 545.699 421.208C543.635 422.12 541.427 422.576 539.075 422.576C535.955 422.576 533.147 421.928 530.651 420.632C528.203 419.336 526.259 417.416 524.819 414.872C523.427 412.328 522.731 409.256 522.731 405.656V382.328H530.867V404.432C530.867 407.984 531.755 410.72 533.531 412.64C535.307 414.512 537.731 415.448 540.803 415.448C543.875 415.448 546.299 414.512 548.075 412.64C549.899 410.72 550.811 407.984 550.811 404.432V382.328H559.019ZM578.057 368.72V422H569.849V368.72H578.057ZM598.41 389.024V410.984C598.41 412.472 598.746 413.552 599.418 414.224C600.138 414.848 601.338 415.16 603.018 415.16H608.058V422H601.578C597.882 422 595.05 421.136 593.082 419.408C591.114 417.68 590.13 414.872 590.13 410.984V389.024H585.45V382.328H590.13V372.464H598.41V382.328H608.058V389.024H598.41ZM630.023 422.648C626.903 422.648 624.095 422.096 621.599 420.992C619.151 419.84 617.207 418.304 615.767 416.384C614.327 414.416 613.559 412.232 613.463 409.832H621.959C622.103 411.512 622.895 412.928 624.335 414.08C625.823 415.184 627.671 415.736 629.879 415.736C632.183 415.736 633.959 415.304 635.207 414.44C636.503 413.528 637.151 412.376 637.151 410.984C637.151 409.496 636.431 408.392 634.991 407.672C633.599 406.952 631.367 406.16 628.295 405.296C625.319 404.48 622.895 403.688 621.023 402.92C619.151 402.152 617.519 400.976 616.127 399.392C614.783 397.808 614.111 395.72 614.111 393.128C614.111 391.016 614.735 389.096 615.983 387.368C617.231 385.592 619.007 384.2 621.311 383.192C623.663 382.184 626.351 381.68 629.375 381.68C633.887 381.68 637.511 382.832 640.247 385.136C643.031 387.392 644.519 390.488 644.711 394.424H636.503C636.359 392.648 635.639 391.232 634.343 390.176C633.047 389.12 631.295 388.592 629.087 388.592C626.927 388.592 625.271 389 624.119 389.816C622.967 390.632 622.391 391.712 622.391 393.056C622.391 394.112 622.775 395 623.543 395.72C624.311 396.44 625.247 397.016 626.351 397.448C627.455 397.832 629.087 398.336 631.247 398.96C634.127 399.728 636.479 400.52 638.303 401.336C640.175 402.104 641.783 403.256 643.127 404.792C644.471 406.328 645.167 408.368 645.215 410.912C645.215 413.168 644.591 415.184 643.343 416.96C642.095 418.736 640.319 420.128 638.015 421.136C635.759 422.144 633.095 422.648 630.023 422.648Z" fill="#001534"/>
<defs>
<linearGradient id="paint0_linear" x1="416" y1="0" x2="416" y2="804" gradientUnits="userSpaceOnUse">
<stop stop-color="#A1D7CA"/>
<stop offset="1" stop-color="#9765E8" stop-opacity="0.5"/>
</linearGradient>
</defs>
</svg>

</div>
{{taskPage ? '' : 'no result!'}}

<div class="oldtask" v-if="taskPage">
    <div class="headList">
        <div class="test">_id</div>
        <div class="test">explanations</div>
        <div class="test">time</div>
        <div class="test">view<i class="cavet"></i></div>
    </div>
    <div class="f">
    <div class="list" v-for="(task, tag) in tasks" :key="tag">
        <span class="delete" @click="deleteTask"> &times;</span>
        <div class="test id">#Test_{{task.fakeId}}</div>
        <div class="test exp">{{task.explanation}}</div>
        <div class="test time">{{moment(task.createdAt).fromNow()}}</div>
        <div class="test btn" @click="result">open<i class="cavet"></i></div>
    </div>
    </div>
     <div class="paginate" v-if="pages > 1">
     <button class="prev" v-if="page >= pages" @click="paginate(-1)">prev</button>
     <button class="prev" v-else-if="page > 1 && page < pages" @click="paginate(-1)">prev</button>
      page {{page}}/{{pages}}
      <button v-if="page < pages" class="next" @click="paginate(+1)">next</button>
 </div>
</div>
    </div>

    <div class="darkmode" @click="removeModal"  v-if="display">
    <div class="containerM">
        <div class="close" @click="display = false">close</div>
      <modal :exp="explanation"/>
    </div>
</div>
</div>
</template>
<script>
import gql from "graphql-tag"
import moment from "moment"
import pagination from "../backdata/pagination"
import modal from "../components/modal"
export default {
    data (){
        return {
      scroll: false,
      moment: moment,
      pages: '',
      page: '',
      taskPage: '',
      currentPage: 0,
      res: '',
      explanation: '',
      display: false
        }
    },
    components: {
     modal
    },
    computed:{
        tasks () {
         if (this.$store.state.task) return this.$store.state.task
        },
    },
    methods: {
     result (event) {
         this.display = !this.display
         const exp = event.target.parentElement.querySelector('.exp')
         if (exp) {
         this.explanation = exp.textContent
         }
     },
    deleteTask (event) {
      const id = event.target.parentElement.querySelector('.id').textContent
      const replaced = JSON.parse(id.replace('#Test_', '') )
      const count = replaced
      JSON.parse(replaced)
      const agree = confirm('wanna delete ' + id)
      if (!agree) {
         return 
      }
      this.$apollo.mutate({
        mutation: gql`mutation deleteTask($count: Int!){deleteTask(count: $count)}`,
        variables: {
            count
        }
        }).then(res => {
            location.reload()
        })
     },
     removeModal (ev) {
        if (ev.target.parentElement.querySelector('.darkmode')) {
            this.display = false
        }
     },
     paginate (ev) {
         if (ev === -1) {
            //  prev
            this.currentPage  = this.currentPage -1
            this.update(this.res)
         } else if (ev === 1) {
            //  next
            this.currentPage  = this.currentPage + ev
            this.update(this.res)

         }
     },
      update (result) {
        let pag = new pagination (result, this.currentPage)
        this.pages = pag.pages()
        this.page = pag.page()
        this.$store.commit('task', pag.paginate())
      }
    },
    created () {
      this.$apollo.mutate({
        mutation: gql`mutation getTasks{getTask{id, explanation, createdAt, fakeId}}`
          }).then((result) => {
            this.taskPage = false
            if (result.data.getTask.length) {
            this.taskPage = true
            this.res = result
            this.update(result)
            }
          })
    },

}

</script>
<style scoped>
.scroll {
    transition: .5s;
    transform: scale(0, 0);
    display: none;
}
.logo {
    display: flex;
    justify-content: center;
}
.container {
    width: 100vw;
}
svg {
position: relative;
}
.spin {
    display: none;
}
.box{ 
    position: absolute;
    top: 0;
    left: 610px;
}
.oldtask {
    font-family: 'poppins';
    padding: 20px;

    /* display: flex;
    width: 80%; */
}
.headList {
    display: flex;
    justify-content: space-between;
    background: #c4c4c4;
    padding: 10px;
    color: #fff;
    margin-bottom: 5px;
}
.test {
    width: 100%;
    text-align: center;
}

.list {
    display: flex;
    justify-content: space-between;
    margin-bottom: .75rem;
        background: rgb(1, 6, 48);
    padding: 5px;
    color: #ccc;
    border-radius: 10px;
}
.id {
    font-weight: bold;
}
.paginate {
    display: flex;
    justify-content: space-around;
    font-family: 'poppins';
    margin: 5px;
}
.next, .prev {
    border: none;
    background: #005;
    width: 100px;
    color: #fff;
    cursor: pointer;
}
.darkmode {
    position: absolute;
    left: 0;
    top: 0;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(rgba(1, 2, 63, .5), rgba(1, 2, 63, .5));
    display: flex;
    justify-content: center;
    padding: 10px 0 10px 0;
    z-index: 2;

}
.containerM {
    height: 100%;
    width: 600px;
    background: #ffffff;
    overflow-y: scroll;
    scroll-behavior: smooth;
}
.close {
    text-align: center;
    background: rgb(168, 175, 240);
    color: #105;
    font-size: .75rem;
    font-weight: bolder;
    display: none;

}
@media screen and (max-width: 600px) {
    .close {
        display: block;
    }
}
.delete {
    font-size: 1em;
    color: red;
    font-weight: bold;
    cursor: pointer;
}
.exp {
    text-transform: lowercase;
}
</style>
